<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathMaster - Desaf√≠o Matem√°tico</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- ==================== BARRA SUPERIOR GLOBAL ==================== -->
    <div class="top-bar">
        <!-- Usuario actual -->
        <div class="user-badge hidden" id="user-badge">
            <span class="user-avatar">üë§</span>
            <span class="user-name" id="current-user-name">Jugador</span>
            <button class="user-menu-btn" id="user-menu-btn" aria-label="Men√∫ de usuario">‚ñº</button>
        </div>

        <!-- Controles -->
        <div class="top-controls">
            <button id="settings-btn" class="icon-btn" aria-label="Configuraci√≥n" title="Configuraci√≥n">
                ‚öôÔ∏è
            </button>
            <button id="theme-toggle" class="icon-btn" aria-label="Cambiar tema" title="Cambiar tema claro/oscuro">
                <span class="theme-icon theme-icon-dark">üåô</span>
                <span class="theme-icon theme-icon-light">‚òÄÔ∏è</span>
            </button>
        </div>
    </div>

    <!-- ==================== PANTALLA DE LOGIN/SELECCI√ìN DE USUARIO ==================== -->
    <div id="login-screen" class="screen active">
        <div class="container">
            <header class="game-header">
                <h1 class="game-title">
                    <span class="math-symbol">+</span>
                    MathMaster
                    <span class="math-symbol">=</span>
                </h1>
                <p class="game-subtitle">Desaf√≠o por Puntuaci√≥n Fija</p>
            </header>

            <section class="login-section">
                <h2 class="section-title">Selecciona o crea tu perfil</h2>

                <!-- Lista de usuarios existentes -->
                <div class="users-list" id="users-list">
                    <!-- Se llena din√°micamente -->
                </div>

                <!-- Crear nuevo usuario -->
                <div class="new-user-form">
                    <input
                        type="text"
                        id="new-username"
                        class="username-input"
                        placeholder="Nombre del jugador"
                        maxlength="20"
                        autocomplete="off"
                    >
                    <button id="create-user-btn" class="action-button primary">
                        <span class="btn-icon">‚ûï</span>
                        Crear Perfil
                    </button>
                </div>

                <!-- Opci√≥n de jugar sin cuenta -->
                <div class="guest-option">
                    <button id="play-guest-btn" class="action-button secondary">
                        <span class="btn-icon">üë§</span>
                        Jugar como Invitado
                    </button>
                </div>
            </section>

            <footer class="game-footer">
                <p>Desarrollado por EFC | MathMaster v2.0</p>
            </footer>
        </div>
    </div>

    <!-- ==================== PANTALLA DE SELECCI√ìN ==================== -->
    <div id="selection-screen" class="screen">
        <div class="container">
            <!-- Logo y T√≠tulo -->
            <header class="game-header">
                <h1 class="game-title">
                    <span class="math-symbol">+</span>
                    MathMaster
                    <span class="math-symbol">=</span>
                </h1>
                <p class="game-subtitle">Desaf√≠o por Puntuaci√≥n Fija</p>
            </header>

            <!-- Selecci√≥n de Operaci√≥n -->
            <section class="selection-section">
                <h2 class="section-title">Elige la Operaci√≥n</h2>
                <div class="operation-buttons">
                    <button class="operation-btn" data-operation="suma">
                        <span class="op-symbol">+</span>
                        <span class="op-name">Suma</span>
                    </button>
                    <button class="operation-btn" data-operation="resta">
                        <span class="op-symbol">‚àí</span>
                        <span class="op-name">Resta</span>
                    </button>
                    <button class="operation-btn" data-operation="multiplicacion">
                        <span class="op-symbol">√ó</span>
                        <span class="op-name">Multiplicaci√≥n</span>
                    </button>
                    <button class="operation-btn" data-operation="division">
                        <span class="op-symbol">√∑</span>
                        <span class="op-name">Divisi√≥n</span>
                    </button>
                    <button class="operation-btn" data-operation="tablas">
                        <span class="op-symbol">T</span>
                        <span class="op-name">Tablas</span>
                    </button>
                </div>
            </section>

            <!-- Selecci√≥n de Nivel de Dificultad -->
            <section class="selection-section" id="level-section">
                <h2 class="section-title">Nivel de Dificultad</h2>
                <div class="level-buttons">
                    <button class="level-btn" data-level="1">1</button>
                    <button class="level-btn" data-level="2">2</button>
                    <button class="level-btn" data-level="3">3</button>
                    <button class="level-btn" data-level="4">4</button>
                    <button class="level-btn" data-level="5">5</button>
                    <button class="level-btn" data-level="6">6</button>
                    <button class="level-btn" data-level="7">7</button>
                    <button class="level-btn" data-level="8">8</button>
                    <button class="level-btn" data-level="9">9</button>
                    <button class="level-btn" data-level="10">10</button>
                </div>
                <p id="level-description" class="level-description">Selecciona un nivel para ver su descripci√≥n</p>
            </section>

            <!-- Selecci√≥n de Tabla (solo visible en modo tablas) -->
            <section class="selection-section hidden" id="table-section">
                <h2 class="section-title">Tabla del...</h2>
                <div class="table-buttons">
                    <button class="table-btn" data-table="1">1</button>
                    <button class="table-btn" data-table="2">2</button>
                    <button class="table-btn" data-table="3">3</button>
                    <button class="table-btn" data-table="4">4</button>
                    <button class="table-btn" data-table="5">5</button>
                    <button class="table-btn" data-table="6">6</button>
                    <button class="table-btn" data-table="7">7</button>
                    <button class="table-btn" data-table="8">8</button>
                    <button class="table-btn" data-table="9">9</button>
                    <button class="table-btn" data-table="10">10</button>
                    <button class="table-btn table-todas" data-table="todas">Todas</button>
                </div>
            </section>

            <!-- Selecci√≥n de Cantidad de Preguntas -->
            <section class="selection-section">
                <h2 class="section-title">Cantidad de Preguntas</h2>
                <div class="questions-buttons">
                    <button class="questions-btn" data-questions="20">20</button>
                    <button class="questions-btn selected" data-questions="30">30</button>
                    <button class="questions-btn" data-questions="40">40</button>
                </div>
            </section>

            <!-- Bot√≥n de Iniciar -->
            <button id="start-btn" class="start-button" disabled>
                <span class="btn-icon">üéÆ</span>
                <span class="btn-text">¬°EMPEZAR!</span>
            </button>

            <!-- Acceso R√°pido -->
            <div class="quick-access">
                <button id="stats-btn" class="quick-btn" title="Ver estad√≠sticas">
                    üìä Estad√≠sticas
                </button>
                <button id="achievements-btn" class="quick-btn" title="Ver logros">
                    üèÜ Logros
                </button>
            </div>

            <!-- Footer -->
            <footer class="game-footer">
                <p>Desarrollado por EFC | MathMaster v2.0</p>
            </footer>
        </div>
    </div>

    <!-- ==================== PANTALLA DE JUEGO ==================== -->
    <div id="game-screen" class="screen">
        <div class="container game-container">
            <!-- Indicador de Operaci√≥n y Nivel -->
            <div class="operation-indicator" id="operation-indicator">Suma - Nivel 1</div>

            <!-- Barra Superior: Stats del Juego -->
            <header class="game-stats">
                <div class="stat-item">
                    <span class="stat-label">Tiempo</span>
                    <span class="stat-value timer" id="timer">00:00</span>
                </div>
                <div class="stat-item score-item">
                    <span class="stat-label">Puntuaci√≥n</span>
                    <span class="stat-value" id="score">0 / 30</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Racha</span>
                    <span class="stat-value streak" id="streak">üî• 0</span>
                </div>
            </header>

            <!-- Barra de Progreso -->
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>

            <!-- √Årea de Pregunta -->
            <main class="question-area">
                <div class="question-box">
                    <span class="question-text" id="question-text">5 + 3 = ?</span>
                    <!-- Bot√≥n TTS para leer pregunta -->
                    <button id="speak-question-btn" class="speak-btn hidden" aria-label="Leer pregunta" title="Leer pregunta en voz alta">
                        üîä
                    </button>
                </div>

                <!-- Campo de Respuesta -->
                <div class="answer-area">
                    <input
                        type="text"
                        id="answer-input"
                        class="answer-input"
                        placeholder="Tu respuesta"
                        autocomplete="off"
                        inputmode="decimal"
                    >
                    <button id="submit-btn" class="submit-button">
                        Verificar
                    </button>
                </div>

                <!-- Feedback -->
                <div class="feedback-container" id="feedback-container">
                    <span class="feedback-text" id="feedback-text"></span>
                    <span class="hint-text" id="hint-text"></span>
                </div>
            </main>

            <!-- Teclado Num√©rico (para m√≥viles) -->
            <div class="numpad" id="numpad">
                <button class="numpad-btn" data-value="7">7</button>
                <button class="numpad-btn" data-value="8">8</button>
                <button class="numpad-btn" data-value="9">9</button>
                <button class="numpad-btn" data-value="4">4</button>
                <button class="numpad-btn" data-value="5">5</button>
                <button class="numpad-btn" data-value="6">6</button>
                <button class="numpad-btn" data-value="1">1</button>
                <button class="numpad-btn" data-value="2">2</button>
                <button class="numpad-btn" data-value="3">3</button>
                <button class="numpad-btn negative-btn" data-value="-">‚àí</button>
                <button class="numpad-btn" data-value="0">0</button>
                <button class="numpad-btn" data-value=".">.</button>
                <button class="numpad-btn delete-btn" data-value="delete">‚å´</button>
                <button class="numpad-btn clear-btn" data-value="clear">C</button>
                <button class="numpad-btn enter-btn" data-value="enter">‚úì</button>
            </div>

            <!-- Controles del Juego -->
            <div class="game-controls">
                <button id="pause-btn" class="control-btn">‚è∏Ô∏è Pausar</button>
                <button id="quit-btn" class="control-btn quit">üö™ Salir</button>
            </div>
        </div>
    </div>

    <!-- ==================== PANTALLA DE PAUSA ==================== -->
    <div id="pause-overlay" class="overlay hidden">
        <div class="overlay-content">
            <h2>‚è∏Ô∏è Juego Pausado</h2>
            <p class="pause-stats">Respuestas: <span id="pause-score">0</span> | Tiempo: <span id="pause-time">00:00</span></p>
            <button id="resume-btn" class="action-button primary">‚ñ∂Ô∏è Continuar</button>
            <button id="restart-btn" class="action-button secondary">üîÑ Reiniciar</button>
            <button id="pause-quit-btn" class="action-button secondary">üè† Men√∫ Principal</button>
        </div>
    </div>

    <!-- ==================== PANTALLA DE RESULTADOS ==================== -->
    <div id="results-screen" class="screen">
        <div class="container results-container">
            <header class="results-header">
                <h2 class="results-title" id="results-title">¬°Felicitaciones!</h2>
                <div class="results-emoji" id="results-emoji">üèÜ</div>
            </header>

            <!-- Estad√≠sticas Finales -->
            <div class="results-stats">
                <div class="result-stat main-stat">
                    <span class="result-label">Respuestas Correctas</span>
                    <span class="result-value" id="final-score">30 / 30</span>
                </div>
                <div class="result-stat">
                    <span class="result-label">Tiempo Total</span>
                    <span class="result-value" id="total-time">05:30</span>
                </div>
                <div class="result-stat">
                    <span class="result-label">Mejor Racha</span>
                    <span class="result-value" id="best-streak">15</span>
                </div>
                <div class="result-stat">
                    <span class="result-label">Precisi√≥n</span>
                    <span class="result-value" id="accuracy">100%</span>
                </div>
                <div class="result-stat">
                    <span class="result-label">Intentos Totales</span>
                    <span class="result-value" id="total-attempts">30</span>
                </div>
                <div class="result-stat">
                    <span class="result-label">Promedio por Pregunta</span>
                    <span class="result-value" id="avg-time">11s</span>
                </div>
            </div>

            <!-- R√©cord Personal -->
            <div class="record-section hidden" id="record-section">
                <span class="record-badge">üåü ¬°Nuevo R√©cord de Tiempo!</span>
            </div>

            <!-- Logros Desbloqueados -->
            <div class="unlocked-achievements hidden" id="unlocked-achievements">
                <h3>üèÜ Logros Desbloqueados</h3>
                <div class="achievements-list" id="results-achievements-list">
                    <!-- Se llena din√°micamente -->
                </div>
            </div>

            <!-- Botones de Acci√≥n -->
            <div class="results-actions">
                <button id="retry-btn" class="action-button primary">
                    <span class="btn-icon">üîÑ</span>
                    Jugar de Nuevo
                </button>
                <button id="menu-btn" class="action-button secondary">
                    <span class="btn-icon">üè†</span>
                    Men√∫ Principal
                </button>
            </div>
        </div>
    </div>

    <!-- ==================== PANTALLA DE ESTAD√çSTICAS ==================== -->
    <div id="stats-screen" class="screen">
        <div class="container">
            <header class="screen-header">
                <button class="back-btn" id="stats-back-btn">‚Üê Volver</button>
                <h2>üìä Estad√≠sticas</h2>
            </header>

            <div class="stats-content" id="stats-content">
                <!-- Estad√≠sticas Generales -->
                <section class="stats-section">
                    <h3>Resumen General</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-card-value" id="stat-total-games">0</span>
                            <span class="stat-card-label">Partidas Jugadas</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-card-value" id="stat-total-correct">0</span>
                            <span class="stat-card-label">Respuestas Correctas</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-card-value" id="stat-accuracy">0%</span>
                            <span class="stat-card-label">Precisi√≥n Global</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-card-value" id="stat-best-streak">0</span>
                            <span class="stat-card-label">Mejor Racha</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-card-value" id="stat-total-time">0h 0m</span>
                            <span class="stat-card-label">Tiempo Total</span>
                        </div>
                    </div>
                </section>

                <!-- Por Operaci√≥n -->
                <section class="stats-section">
                    <h3>Por Operaci√≥n</h3>
                    <div class="operation-stats" id="operation-stats">
                        <!-- Se llena din√°micamente -->
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- ==================== PANTALLA DE LOGROS ==================== -->
    <div id="achievements-screen" class="screen">
        <div class="container">
            <header class="screen-header">
                <button class="back-btn" id="achievements-back-btn">‚Üê Volver</button>
                <h2>üèÜ Logros</h2>
            </header>

            <div class="achievements-content" id="achievements-content">
                <!-- Se llena din√°micamente con MathMasterAchievements.renderAchievementsList() -->
            </div>
        </div>
    </div>

    <!-- ==================== MODAL DE CONFIGURACI√ìN ==================== -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
            <header class="modal-header">
                <h2>‚öôÔ∏è Configuraci√≥n</h2>
                <button class="close-modal-btn" id="close-settings-btn" aria-label="Cerrar">‚úï</button>
            </header>

            <div class="settings-content">
                <!-- Audio -->
                <section class="settings-section">
                    <h3>üîä Audio</h3>

                    <div class="setting-item">
                        <label class="setting-label">
                            <span>Efectos de Sonido</span>
                            <span class="setting-description">Sonidos para aciertos, errores y logros</span>
                        </label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="setting-sound" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="setting-item">
                        <label class="setting-label">
                            <span>Volumen</span>
                        </label>
                        <input type="range" id="setting-volume" min="0" max="100" value="80" class="volume-slider">
                    </div>

                    <div class="setting-item">
                        <label class="setting-label">
                            <span>Lectura en Voz Alta (TTS)</span>
                            <span class="setting-description">Lee las preguntas y resultados</span>
                        </label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="setting-tts">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </section>

                <!-- Accesibilidad -->
                <section class="settings-section">
                    <h3>‚ôø Accesibilidad</h3>

                    <div class="setting-item">
                        <label class="setting-label">
                            <span>Modo Alto Contraste</span>
                            <span class="setting-description">Mejora la visibilidad para personas con dificultades visuales</span>
                        </label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="setting-high-contrast">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </section>

                <!-- Cuenta -->
                <section class="settings-section" id="account-settings">
                    <h3>üë§ Cuenta</h3>

                    <div class="setting-item">
                        <label class="setting-label">
                            <span>Usuario Actual</span>
                            <span class="setting-description" id="settings-current-user">Invitado</span>
                        </label>
                        <button class="setting-btn" id="change-user-btn">Cambiar</button>
                    </div>

                    <div class="setting-item danger-zone hidden" id="delete-account-section">
                        <label class="setting-label">
                            <span>Eliminar Cuenta</span>
                            <span class="setting-description">Esta acci√≥n no se puede deshacer</span>
                        </label>
                        <button class="setting-btn danger" id="delete-account-btn">Eliminar</button>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- ==================== MODAL DE CONFIRMACI√ìN ==================== -->
    <div id="confirm-modal" class="modal hidden">
        <div class="modal-content modal-small">
            <h3 id="confirm-title">¬øEst√°s seguro?</h3>
            <p id="confirm-message">Esta acci√≥n no se puede deshacer.</p>
            <div class="modal-actions">
                <button class="action-button secondary" id="confirm-cancel-btn">Cancelar</button>
                <button class="action-button danger" id="confirm-ok-btn">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- ==================== MEN√ö DE USUARIO ==================== -->
    <div id="user-menu" class="dropdown-menu hidden">
        <button class="menu-item" id="menu-profile">üë§ Mi Perfil</button>
        <button class="menu-item" id="menu-stats">üìä Estad√≠sticas</button>
        <button class="menu-item" id="menu-achievements">üèÜ Logros</button>
        <hr class="menu-divider">
        <button class="menu-item" id="menu-logout">üö™ Cerrar Sesi√≥n</button>
    </div>

    <!-- ==================== CONTENEDOR DE NOTIFICACIONES ==================== -->
    <div id="notifications-container" class="notifications-container">
        <!-- Las notificaciones de logros aparecen aqu√≠ -->
    </div>

    <!-- Scripts del Juego -->
    <script src="database.js"></script>
    <script src="audio.js"></script>
    <script src="achievements.js"></script>
    <script src="game.js"></script>
</body>
</html>
